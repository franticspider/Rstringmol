---
title: "R Notebook"
output: html_notebook
---


```{r}
froot <- "~/Desktop/paulien/smsp/1705smsp/out1/"
froot <- "D:/sjh/stringmol/smsp/1705smsp/out1/"
```


Let's load the final conf file: 

```{r}

  cf <- read.table(sprintf("%sout1_2000000.conf",froot),as.is = T, fill = T, sep=" ",comment.char="",stringsAsFactors = F)
```

Now we need to find the most numerous spp - let's write a function to do that: 

```{r}
get_top_spp <- function(data){
  
  boundspp <-  data[data$V1 == "###############",]
  unboundspp <- data[data$V1 == "AGENT",]
  
  spp <- c(boundspp$V4,unboundspp$V3)
  
  spd <- data.frame(spp = unique(spp),stringsAsFactors = F)
  spd$count <- 0
  
  for(ss in 1:nrow(spd)){
    spss <- spp[spp == spd$spp[ss]]
    spd$count[ss] = length(spss)
  }
  
  spd <- spd[order(spd$count,decreasing = T),]
  
  return(spd)
  
}

spp <- get_top_spp(cf)

```

This gives us a ranked list of species. We can then interrogate this list to see how the system is working.

The most numerous species is `P=?>G^B$=?>$BLU%}YH` - if we run this through the web app at http://stringmol.york.ac.uk/webapp/, then we can see that this is not a self-replicator - bind prob is 0.644, runs for 42 steps - so this parasite wastes time binding! The bind site is interesting - it's at `$=?>$`

 `C=?>G^BB$=P?>$BLU%}QYH` copies the parasite above. Does not bind to self - so what copies it? `P=?>G^>B$=?>$ALVO%NY^B` - we have a hypercycle with a rate war!
 
 `P=?>G^>B$=?>$ALVO%NY^B` self-binds, but dissociates with no product after 5 steps. 
 
 
 # Run 2: 
 
 Let's try this with another run: 
 
```{r}
froot <- "~/Desktop/paulien/smsp/1705smsp/out2/"
froot <- "D:/sjh/stringmol/smsp/1705smsp/out3/"
cf <- read.table(sprintf("%sout1_2000000.conf",froot),as.is = T, fill = T, sep=" ",comment.char="",stringsAsFactors = F)
spp <- get_top_spp(cf)
head(spp,n=20)
```


`$=?>^AHCL>Q^B>$BLU%G}YH` Self-replicator with rate limit
 
OK. now let's see if we can classify these replicators using the methods in `example.Rmd`

```{r}
source("../R/splist_stats.R")
source("../R/rconf_stats.R")
source("../R/rconf_data.R")
require(stringr)
reactions <- rconf_stats(fn = sprintf("%sout1_%d.conf",froot,2000000), 
                                      spfn = sprintf("%ssplist%d.dat",froot,2000000),
                                      verbose=F)
```



```{r fig.height=6, fig.width=6}
plot(NA,xlim=c(1,11),ylim=c(1,11),axes=F,xlab="machine",ylab="template",asp = 1)
colER <- "red"
colPR <- "pink"
colPN <- "purple"
colPA <- "green"
colNP <- "black"
colDP <- "orange"
colDN <- "brown"
for(mm in 1:10){
  for(tt in 1:10){
    rap <- reactions[reactions$actseq==spp$spp[mm] & reactions$passeq == spp$spp[tt],]
    sqcol <- "white"
    if(nrow(rap) == 1){
      if(rap$type == "ER") sqcol <- colER
      if(rap$type == "PR") sqcol <- colPR
      if(rap$type == "PN") sqcol <- colPN
      if(rap$type == "PA") sqcol <- colPA
      if(rap$type == "NP") sqcol <- colNP
      if(rap$type == "DP") sqcol <- colPR
      if(rap$type == "DN") sqcol <- colPR
    }
    else{
     message(sprintf("%d reactions for spp %d and %d!",nrow(rap),mm,tt))
    }
    
    
    
    
    
    col<-cols[(((mm-1)*10+tt)%%11)+1]
    rect(xleft = mm,xright=mm+1,ybottom = tt,ytop = tt+1,col=sqcol,border = col)
  }           

}
```
 
 









