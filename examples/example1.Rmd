---
title: "Stringmol run analysis"
output: html_notebook
---


# Popdy

First thing we want is overall pop size in a file. This function is in `14.04/home/sjh/Desktop/sjh/stringmol/R/plotpopdy.R`

```{r}
plot.onepop <- function(infn,outfn,w,h, col.fun=rainbow, totpop = F, plotnspp = F, log = "", time.lim= NA, minpop=0){
	x	<- read.table(infn,sep=",", col.names=c('time', 'species', 'count'))
	
	if(is.na(time.lim))
	  time.lim <- range(x$time)
	
	valid.species <- unique(x$species)
	colours <- col.fun(length(valid.species))
	
	if(totpop){
	  times <- as.data.frame(unique(x$time))
	  times$pop <- 0
	  colnames(times) <- c("time","pop")
	  for(tt in 1:nrow(times)){
	    data <- x[x$time == times$time[tt],]
	    times$pop[tt] = sum(data$count)
	  }
	  
	  tpmax =max(times$pop)
	}
	else{
	  tpmax=0
	}
	
	
	
	if(plotnspp){
	  nspp <- as.data.frame(unique(x$time))
	  nspp$nspp <- 0
	  colnames(nspp) <- c("time","nspp")
	  for(tt in 1:nrow(times)){
	    data <- x[x$time == times$time[tt],]
	    nspp$nspp[tt] <- nrow(data)
	  }
	  #return(nspp)
	}
	
	y.lim <- c(1, max(x$count,tpmax))#max(x$count))
	# pdf(file=outfn, height=h, width=w, title=outfn)
	#  	par(mar=c(5,5, 0.1, 0.1))
	plot(NA, xlim=time.lim, ylim=y.lim, ann=FALSE, axes=FALSE, log = log )
	sapply(1:length(valid.species), function(i){
		data <- x[x$species==valid.species[i],]
		if(max(data$count > minpop))
		  lines(x=data$time, y=data$count + 0.1, col=colours[i])
	})
	
	if(totpop)
		  lines(x=times$time,y=times$pop,lwd=2,col="red")
	
	
	axis(2, las=2)
	title(ylab='population')
	x.positions <- seq(from=time.lim[1], to=time.lim[2], length.out=20)
	axis(1, at=x.positions, labels=sprintf('%d', x.positions / 1e3))
	
	
	if(plotnspp){
	  par(new = T)
	  plot(x=nspp$time,y=nspp$nspp,axes=F,xlab=NA,ylab=NA,type="l",lty=2,col="green")
	  axis(side=4)
	}
	
	
	title(xlab=expression(time%*%10^3))
	#box()
	# dev.off()
}


plot.onepop("~/Desktop/paulien/confs/out3/popdy001.dat","example1popdy.pdf",12,12,minpop=100, totpop=T,plotnspp = T)
```


Concerns:
- this only records pop every 10000 timesteps - potentially many generations between recordings. Understandable though - if we find a particular feature, we can go back and rerun to get more detail. 

# Community structure





# Ancestry
